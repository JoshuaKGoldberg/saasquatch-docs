@sections.apiReference(
    "Rest API Reference",
    "Our Rest API let's you build your own custom logic on top of your referral program. This API reference includes a guide to using all the methods of the Referral SaaSquatch Rest API."
) {
    <section>
        <div class="page-header">
            <h1>Rest API Reference</h1>
        </div>

        <p class="lead">
            Our Rest API let's you build your own custom logic on top of your referral program. This API reference includes a guide to using all the methods of the Referral SaaSquatch Rest API
        </p>

        @tags.apiSummaryTable()
        
        
        <h2>Update an account</h2>
        <a id="account_sync" name="account_sync" class="section-anchor">&nbsp;</a>

        <p>Use this method to update SaaSquatch when the status of an account changes or when a new account is created. 
            If you're using a payment system connector, such as the Recurly connector, then you won't need to use this method. We automatically track account status for Braintree, Stripe, Reculy and Zuora.</p>
        <h4>Definition</h4>
        <pre class="prettyprint lang-curl">POST https://app.referralsaasquatch.com/api/v1/{TENANT_ALIAS}/accountsync</pre>


        <ul class="nav nav-tabs">
          <li class="active"><a href="#home" data-toggle="tab">Example Request</a></li>
          <li class=""><a href="#profile" data-toggle="tab">Example Response</a></li>
        </ul>
        <div id="myTabContent" class="tab-content">
          <div class="tab-pane fade active in" id="home">
            <p>Raw denim you probably haven't heard of them jean shorts Austin. Nesciunt tofu stumptown aliqua, retro synth master cleanse. Mustache cliche tempor, williamsburg carles vegan helvetica. Reprehenderit butcher retro keffiyeh dreamcatcher synth. Cosby sweater eu banh mi, qui irure terry richardson ex squid. Aliquip placeat salvia cillum iphone. Seitan aliquip quis cardigan american apparel, butcher voluptate nisi qui.</p>
          </div>
          <div class="tab-pane fade" id="profile">
            <p>Food truck fixie locavore, accusamus mcsweeney's marfa nulla single-origin coffee squid. Exercitation +1 labore velit, blog sartorial PBR leggings next level wes anderson artisan four loko farm-to-table craft beer twee. Qui photo booth letterpress, commodo enim craft beer mlkshk aliquip jean shorts ullamco ad vinyl cillum PBR. Homo nostrud organic, assumenda labore aesthetic magna delectus mollit. Keytar helvetica VHS salvia yr, vero magna velit sapiente labore stumptown. Vegan fanny pack odio cillum wes anderson 8-bit, sustainable jean shorts beard ut DIY ethical culpa terry richardson biodiesel. Art party scenester stumptown, tumblr butcher vero sint qui sapiente accusamus tattooed echo park.</p>
          </div>
          <div class="tab-pane fade" id="dropdown1">
            <p>Etsy mixtape wayfarers, ethical wes anderson tofu before they sold out mcsweeney's organic lomo retro fanny pack lo-fi farm-to-table readymade. Messenger bag gentrify pitchfork tattooed craft beer, iphone skateboard locavore carles etsy salvia banksy hoodie helvetica. DIY synth PBR banksy irony. Leggings gentrify squid 8-bit cred pitchfork. Williamsburg banh mi whatever gluten-free, carles pitchfork biodiesel fixie etsy retro mlkshk vice blog. Scenester cred you probably haven't heard of them, vinyl craft beer blog stumptown. Pitchfork sustainable tofu synth chambray yr.</p>
          </div>
          <div class="tab-pane fade" id="dropdown2">
            <p>Trust fund seitan letterpress, keytar raw denim keffiyeh etsy art party before they sold out master cleanse gluten-free squid scenester freegan cosby sweater. Fanny pack portland seitan DIY, art party locavore wolf cliche high life echo park Austin. Cred vinyl keffiyeh DIY salvia PBR, banh mi before they sold out farm-to-table VHS viral locavore cosby sweater. Lomo wolf viral, mustache readymade thundercats keffiyeh craft beer marfa ethical. Wolf salvia freegan, sartorial keffiyeh echo park vegan.</p>
          </div>
        </div>

          
        <h4>Arguments</h4>
        <div>
            <table class="table table-hover apidocs-args">
              <tr>
                <th class="docs-monospace">id</th>
                <td><span class="label">Required</span><br/>
                    The id of the account. This should be the same <code>account_id</code> used for <a href="/app-integration">squatch.js</a>. Not sure what to use here? See <a href="/shared-vs-solo-accounts">Shared vs. Solo accounts</a>
                </td>
              </tr>
              <tr>
                <th class="docs-monospace">subscription</th>
                <td><span class="label">Required</span></td>
                <td>
                    An object describing the current subscription for this account.<br><br>

                    <table class="table table-hover">
                          <tr>
                            <th class="docs-monospace">status</th>
                            <td>
                                The status of the subscription. One of <code>PAID</code>, <code>TRAIL</code>, <code>FREE</code> or <code>CANCELLED</code>, 
                            </td>
                          </tr>
                          <tr>
                            <th class="docs-monospace">billingIntervalType</th>
                            <td>
                                The unit type for <code>billingIntervalValue</code>. One of <code>DAY</code>, <code>WEEK</code>, <code>MONTH</code>,  <code>QUARTER</code>, <code>SEMI_ANNUAL</code> or <code>YEAR</code>.
                                Required when <code>status: PAID</code>.
                            </td>
                          </tr>
                          <tr>
                            <th class="docs-monospace">billingIntervalValue</th>
                            <td>
                                The number of <code>billingIntervalType</code>. Required when <code>status: PAID</code>.<br/>
                                
                                <table class="table">
                                    <caption>Example billing intervals</caption>
                                    <tr><td></td><td>billingIntervalValue</td><td>billingIntervalType</td></tr>
                                    <tr><td>Monthly billing</td><td>1</td><td>MONTH</td></tr>
                                    <tr><td>Yearly billing</td><td>1</td><td>YEAR</td></tr>
                                    <tr><td>4 Month billing</td><td>4</td><td>MONTH</td></tr>
                                </table>

                            </td>
                          </tr>
                          <tr>
                            <th class="docs-monospace">value</th>
                            <td>
                                Dollar value of the subscription per renewal. Required when <code>status: PAID</code>.
                            </td>
                          </tr>
                    </table>
                </td>
              </tr>
              <tr>
                <th class="docs-monospace">referral</th>
                <td><span class="label">Optional</span></td>
                <td>
                    Info about who referred this account. Use this on first signup.<br><br>
                    
                    <table class="table table-hover">
                          <tr>
                            <th class="docs-monospace">code</th>
                            <td>
                                The referral code of the person that referred this account. Use <a href="/squatchjs#autofill">squatch.js autofill</a> to retrieve this value from the tracking cookie on your checkout form.
                            </td>
                          </tr>
                    </table>
                </td>
              </tr>
              <tr>
                <th class="docs-monospace">currency</th>
                <td><span class="label">Optional</span></td>
                <td>
                    Default is "USD". Otherwise use a ISO 4217 Standard currency code in uppercase.
                </td>
              </tr>
              </table>
        </div>
    
        <h4>Returns</h4>
        <p>The current status of the account, mirroring the input, or an HTTP Error code on error.</p>

        @tags.exampleCurl("account_sync",
"""
$ curl https://app.referralsaasquatch.com/api/v1/{TENANT_ALIAS}/accountsync \
-u API_KEY: \
-H "Content-Type: application/json" \
-d '{ "id": "a1234",
"currency": "USD",
"subscription": {
    "status": "PAID",
    "value": 99.99,
    "billingIntervalType": "DAY",
    "billingIntervalValue": 30
  },
"referral": {
    "code": "3j033r"
  }
}'
""",
"""
{ "id": "a1234",
    "currency": "USD",
    "subscription": {
    "status": "PAID",
    "value": 99.99,
    "billingIntervalType": "DAY",
    "billingIntervalValue": 30
  },
  "referral": {
    "code": "3j033r"
  }
}
""")

        <hr />
        
        <h2>List an account's rewards</h2>
        <a id="get_reward" name="get_reward" class="section-anchor">&nbsp;</a>

        <p>Looks up a single reward. Works with: @metadata.API.discount @metadata.API.feature @metadata.API.freeTime @metadata.API.credit</p>
        <h4>Definition</h4>
        <pre class="prettyprint lang-curl">GET https://app.referralsaasquatch.com/api/v2/{TENANT_ALIAS}/reward</pre>

        <h4>Arguments</h4>
        <div>
            <table class="table table-hover">
               <tr>
                <th class="docs-monospace">accountId</th>
                <td><span class="label">Required</span></td>

                <td>
                    The ID of the account to look up.
                </td>
              </tr>

              <tr>
                <th class="docs-monospace">rewardTypeFilter</th>
                <td><span class="label">Optional</span></td>
                <td>
                    Filters rewards by type.
                </td>
              </tr>
              <tr>
                <th class="docs-monospace">featureTypeFilter</th>
                <td><span class="label">Optional</span></td>
                <td>
                    Filters rewards by feature type.
                </td>
              </tr>
              <tr>
                <th class="docs-monospace">userId</th>
                <td><span class="label">Optional</span></td>
                <td>
                    Filters rewards by user.
                </td>
              </tr>
            </table>
        </div>
    
        <h4>Returns</h4>
        <p>A list of rewards</p>

        <table class="table table-hover">
            <tr>
                <th class="docs-monospace">id</th>
                <td>String</td>
                <td>
                    The unique identifier for this reward
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">type</th>
                <td>Enum</td>
                <td>
                    The type of reward. One of either the following:
                    <table class="table">
                        <tr>
                            <td>@metadata.API.discount</td>
                            <td><code>PCT_DISCOUNT</code></td>
                        </tr>
                        <tr>
                            <td>@metadata.API.feature</td>
                            <td><code>FEATURE</code></td>
                        </tr>
                        <tr>
                            <td>@metadata.API.freeTime</td>
                            <td><code>TIME_CREDIT</code></td>
                        </tr>
                        <tr>
                            <td>@metadata.API.credit</td>
                            <td><code>CREDIT</code></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">dateGiven</th>
                <td>Timestamp</td>
                <td>
                    When this reward was earned.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">dateExpires</th>
                <td>Timestamp</td>
                <td>
                    When this reward is set to expire.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">dateCancelled</th>
                <td>Timestamp</td>
                <td>
                    If the reward is <code>cancellable</code> and has been cnacelled, the date it was cancelled on. Null if not never cancelled.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">cancellable</th>
                <td>Boolean</td>
                <td>
                    If a reward is <code>cancellable</code> then it may be revoked. If it has been cancelled then <code>dateCancelled</code> will be non-null.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">rewardSource</th>
                <td>Enum</td>
                <td>
                    The type of the source of the reward. One of either <code>FRIEND_SIGNUP</code> or <code>REFERRED</code>.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">unit</th>
                <td>String</td>
                <td>
                    An identifier for the unit of the reward. E.g. "credit-in-cents", "freemb", "giftcard20", "tshirt", "freemonth"
                </td>
                <td>
                    Works with: <br/>
                    @metadata.API.feature
                    @metadata.API.freeTime
                    @metadata.API.credit
                </td>
            </tr>
            
            <tr>
                <th class="docs-monospace">discountPct</th>
                <td>Integer</td>
                <td>
                    The percent discount. E.g. <code>10</code> means 10%
                </td>
                <td>
                    Works with: <br/> @metadata.API.discount
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">featureType</th>
                <td>String</td>
                <td>
                    A unique identifier for the type of feature. E.g. "freeSeats" or "freeMb".
                </td>
                <td>
                    Works with: <br/>  @metadata.API.feature
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">name</th>
                <td>String</td>
                <td>
                    The name of the feature. e.g. "Free Seats" or "Free Storage"
                </td>
                <td>
                    Works with: <br/> @metadata.API.feature
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">description</th>
                <td>String</td>
                <td>
                    The feature description. e.g. "Bonus user seats for your account" or "Extra megabytes of free storage"
                </td>
                <td>
                    Works with: <br/> @metadata.API.feature
                </td>
            </tr>

            <tr>
                <th class="docs-monospace">quantity</th>
                <td>Integer</td>
                <td>
                    The earned quantity of the feature
                </td>
                <td>
                    Works with: <br/> @metadata.API.feature
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">assignedCredit</th>
                <td>Integer</td>
                <td>
                    The earned quantity of the feature
                </td>
                <td>
                    Works with: <br/> @metadata.API.freeTime @metadata.API.credit
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">redeemedCredit</th>
                <td>Integer</td>
                <td>
                    The redeemed quantity of the feature
                </td>
                <td>
                    Works with: <br/> @metadata.API.freeTime @metadata.API.credit
                </td>
            </tr>
        </table>


        <h4>Example Request</h4>
<pre class="prettyprint lang-curl">$ curl https://app.referralsaasquatch.com/api/v2/{TENANT_ALIAS}/reward?accountId=1 \
-u API_KEY: \
-H "Content-Type: application/json"</pre>

        <hr />
        
        <h2>Set discount code on an account</h2>
        <a id="set_coupon" name="set_coupon" class="section-anchor">&nbsp;</a>

        <p>This method associates a new account with their referrer. Use this method when someone signs up for a paid account to set the coupon code used for them.  For Stripe and Recurly do not use this call. Instead
            during sign-up, just pass the coupon/referral code in your subcribe call. Works with: @metadata.API.discount
        </p>
        <h4>Definition</h4>
        <pre class="prettyprint lang-curl">POST https://app.referralsaasquatch.com/api/v1/{TENANT_ALIAS}/coupon</pre>

        <h4>Arguments</h4>
        <div>
            <table class="table table-hover">
              <tr>
                <th class="docs-monospace">couponCode</th>
                <td><span class="label">Required</span></td>
                <td>
                    The coupon/referral code of the user that referred this user. Can be obtained from the referral-tracking cookie using <a href="#autofill">squatch.js coupon autofill</a>.
                </td>
              </tr>
              <tr>
                <th class="docs-monospace">accountId</th>
                <td><span class="label">Required</span></td>
                <td>
                    We use this ID to link a group of users together. See <a href="/shared-vs-solo-accounts">Shared vs Solo Accounts</a> to see what you should use here.
                </td>
              </tr>
              <tr>
                <th class="docs-monospace">paymentProviderId</th>
                <td><span class="label">Required</span></td>
                <td>
                    The payment provider ID of the newly created account from Braintree or Zuora. This will be the Braintree Account ID or the Zuora Account ID of the newly created account.
                </td>
              </tr>
            </table>
        </div>
    
        <h4>Returns</h4>
        <p>HTTP Status with an Empty Response Body</p>
        <table class="table table-hover">
            <tr>
            <th>Braintree</th>
            <td>
                HTTP 201 on success
            </td>
            <td>
                Sets the value of the <code>saasquatch_coupon</code> custom field in Braintree and triggers an update to the referrer's account.
            </td>
            </tr>
            <tr>
            <th>Recurly</th>
            <td>
                HTTP 400 not implemented
            </td>
            <td>
                Pass the coupon code to <a href="http://docs.recurly.com/api/subscriptions#create-subscription">Recurly Create Subscription</a> instead.
            </td>
            </tr>
            <tr>
            <th>Stripe</th>
            <td>
                HTTP 400 not implemented
            </td>
            <td>
                 Pass the coupon code to <a href="https://stripe.com/docs/api#create_customer">Stripe Create Customer</a> instead.
            </td>
            </tr>
            <tr>
            <th>Zuora</th>
            <td>
                HTTP 201 on success
            </td>
            <td>
                Sets the value of the <code>saasquatchCoupon</code> custom field in Zuora and triggers an update to the referrer's account.
            </td>
            </tr>
            <tr>
            <th>Generic / API</th>
            <td>
                HTTP 400 not implemented
            </td>
            <td>
                Pass the coupon code to the <a href="/api/methods#account_sync">account sync</a> API endpoint instead.
            </td>
            </tr>
        </table>
            

        <h4>Example Request</h4>
<pre class="prettyprint lang-curl">$ curl https://app.referralsaasquatch.com/api/v1/TENANT_ALIAS/coupon \
-u API_KEY: \
-H "Content-Type: application/json" \
-d '{"couponCode" : "BOBTESTERSON", "accountId" : "abc", "paymentProviderId" : "cus_123" }'</pre>

        <hr />
        
        <h2>Lookup a discount code</h2>
        <a id="get_coupon" name="get_coupon" class="section-anchor">&nbsp;</a>

        <p>This method lets you look up the details of a referral code and to ensure that it is valid.  Works with: @metadata.API.discount</p>
        <h4>Definition</h4>
        <pre class="prettyprint lang-curl">GET https://app.referralsaasquatch.com/api/v1/{TENANT_ALIAS}/coupon/{CODE}</pre>

        <h4>Arguments</h4>
        <div>
            <table class="table table-hover">
              <tr>
                <th class="docs-monospace">code</th>
                <td><span class="label">Required</span></td>
                <td>
                    The coupon/referral code to look up
                </td>
              </tr>
            </table>
        </div>
    
        <h4>Returns</h4>
        <p>Information about the coupon, or an HTTP 404 if the coupon code is not found.</p>
        <table class="table table-hover">
            <tr>
                <th class="docs-monospace">couponCode</th>
                <td>String</td>
                <td>
                    The coupon/referral code
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">discountPercentage</th>
                <td>Number</td>
                <td>
                    An integer representing the discount percentage. e.g. For 10% would return the number 10.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">dateCreated</th>
                <td>Timestamp</td>
                <td>
                    The coupon/referral code to look up
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">ratePlanId</th>
                <td>String</td>
                <td>
                    <span class="label">Zuora only</span>
                    The Zuora rate plan ID used to apply this coupon.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">discountId</th>
                <td>String</td>
                <td>
                    <span class="label">Braintree only</span>
                    The Braintree discount ID used to apply this coupon.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">referrerName</th>
                <td>String</td>
                <td>
                    The full name of the referrer who owns this code.
                </td>
            </tr>
        </table>
        
        <h4>Example Request</h4>
<pre class="prettyprint lang-curl">$ curl https://app.referralsaasquatch.com/api/v1/{TENANT_ALIAS}/coupon/JOHNDOE \
-u API_KEY: \
-H "Content-Type: application/json"</pre>

        <h4>Example Response</h4>
<pre class="prettyprint lang-json">{
    "couponCode" : "JOHNDOE", 
    "discountPercentage" : 20, 
    "dateCreated" : 1377727546528,
    "discountId" : "saasquatch_discount"
}</pre>

        <hr />
        
        <h2>Lookup an account's discount</h2>
        <a id="get_account_reward" name="get_account_reward" class="section-anchor">&nbsp;</a>

        <p>This method associates a new account with their referrer. Use this method when someone signs up for a paid account to set the coupon code used for them.  Works with: @metadata.API.discount</p>
        <h4>Definition</h4>
        <pre class="prettyprint lang-curl">GET https://app.referralsaasquatch.com/api/v1/{TENANT_ALIAS}/account/{ACCOUNT_ID}/reward</pre>

        <h4>Arguments</h4>
        <div>
            <table class="table table-hover">
              <tr>
                <th class="docs-monospace">accountId</th>
                <td><span class="label">Required</span></td>
                <td>
                    The account to look up
                </td>
              </tr>
              <tr>
                <th class="docs-monospace">couponCode</th>
                <td><span class="label">Optional</span></td>
                <td>
                    When included, will return a total reward available including any coupon code.
                </td>
              </tr>
              </table>
        </div>
    
        <h4>Returns</h4>
        <p>Information about the account's reward, if any, or an HTTP 404 if the account doesn't exist in SaaSquatch yet.</p>
        <table class="table table-hover">
            <tr>
                <th class="docs-monospace">accountId</th>
                <td>String</td>
                <td>
                    The account id
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">discountPercentage</th>
                <td>Number</td>
                <td>
                    An integer representing the total discount percentage from the referral program. e.g. For 10% would return the number 10. <code>discountPercentage = referredDiscountPercent + referrerDiscountPercent</code>
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">referredDiscountPercent</th>
                <td>Number</td>
                <td>
                    An integer representing the discount percentage from being referred. This will only have a value if the account has a coupon/referral code 
                    already associated with it, or if <code>couponCode</code> was passed as an argument.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">referrerDiscountPercent</th>
                <td>Number</td>
                <td>
                    An integer representing the discount earned from referring other accounts.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">ratePlanId</th>
                <td>String</td>
                <td>
                    <span class="label">Zuora only</span>
                    The Zuora rate plan ID used to apply the discount.
                </td>
            </tr>
            <tr>
                <th class="docs-monospace">discountId</th>
                <td>String</td>
                <td>
                    <span class="label">Braintree only</span>
                    The Braintree discount ID used to apply the discount.
                </td>
            </tr>
            <tr>
            	<th class="docs-monospace">referrerName</th>
            	<td>String</td>
            	<td>
            		The first and last name of the referrer that referred the user or null if no referrer exists.
            	</td>
            </tr>
        </table>
        
        <h4>Example Request</h4>
<pre class="prettyprint lang-curl">$ curl https://app.referralsaasquatch.com/api/v1/{TENANT_ALIAS}/account/SV0TYE5OWI11120144/reward \
-u API_KEY: \
-H "Content-Type: application/json"</pre>

        <h4>Example Response</h4>
<pre class="prettyprint lang-json">{
    "accountId":"SV0TYE5OWI11120144",
    "discountPercentage":10,
    "referrerDiscountPercent":0,
    "referredDiscountPercent":10,
    "discountId":"saasquatch_discount"
}</pre>

        <hr />

        @* 
            Includes the webhook method reference here
        *@
        @tags.webhookMethods()


    </section>
}
